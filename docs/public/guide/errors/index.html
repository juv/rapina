<!doctype html><html lang=en><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content="Opinionated, type-safe, contracts over chaos." name=description><title>Error Handling - Rapina</title><link href=https://arferreira.github.io/rapina/style.css rel=stylesheet><link href=https://arferreira.github.io/rapina/images/rapina-icon.png rel=icon type=image/png><body><nav class=navbar><div class=nav-container><a class=nav-logo href=https://arferreira.github.io/rapina> <img alt=Rapina height=32 src=https://arferreira.github.io/rapina/images/rapina-icon.png> <span>Rapina</span> </a><div class=nav-links><a href=https://arferreira.github.io/rapina/guide> Guide </a><a href=https://arferreira.github.io/rapina/cli> CLI </a><a href=https://arferreira.github.io/rapina/philosophy> Philosophy </a><a href=https://docs.rs/rapina rel=noopener target=_blank> API </a><a class=nav-github href=https://github.com/arferreira/rapina rel=noopener target=_blank> GitHub </a></div></div></nav><main><div class=docs-layout><aside class=docs-sidebar><nav class=docs-nav><h4><a href=https://arferreira.github.io/rapina/guide/>Guide</a></h4><ul><li><a href=https://arferreira.github.io/rapina/guide/getting-started/> Getting Started </a><li><a href=https://arferreira.github.io/rapina/guide/configuration/> Configuration </a><li><a href=https://arferreira.github.io/rapina/guide/extractors/> Extractors </a><li><a href=https://arferreira.github.io/rapina/guide/authentication/> Authentication </a><li><a class=active href=https://arferreira.github.io/rapina/guide/errors/> Error Handling </a></ul></nav></aside><article class=docs-content><h1>Error Handling</h1><p class=page-description>Standardized error responses with trace IDs<p>Rapina provides standardized error handling with consistent response formats and trace IDs for debugging.<h2 id=error-response-format>Error Response Format</h2><p>All errors return a consistent JSON envelope:<pre class=language-json data-lang=json style=color:#c0c5ce;background-color:#2b303b><code class=language-json data-lang=json><span>{
</span><span>  "</span><span style=color:#a3be8c>error</span><span>": {
</span><span>    "</span><span style=color:#a3be8c>code</span><span>": "</span><span style=color:#a3be8c>NOT_FOUND</span><span>",
</span><span>    "</span><span style=color:#a3be8c>message</span><span>": "</span><span style=color:#a3be8c>user not found</span><span>"
</span><span>  },
</span><span>  "</span><span style=color:#a3be8c>trace_id</span><span>": "</span><span style=color:#a3be8c>550e8400-e29b-41d4-a716-446655440000</span><span>"
</span><span>}
</span></code></pre><p>The <code>trace_id</code> is automatically generated for each request and can be used to correlate logs and debug issues.<h2 id=built-in-error-constructors>Built-in Error Constructors</h2><pre class=language-rust data-lang=rust style=color:#c0c5ce;background-color:#2b303b><code class=language-rust data-lang=rust><span>Error::bad_request("</span><span style=color:#a3be8c>invalid input</span><span>")      </span><span style=color:#65737e>// 400
</span><span>Error::unauthorized("</span><span style=color:#a3be8c>login required</span><span>")    </span><span style=color:#65737e>// 401
</span><span>Error::forbidden("</span><span style=color:#a3be8c>access denied</span><span>")        </span><span style=color:#65737e>// 403
</span><span>Error::not_found("</span><span style=color:#a3be8c>user not found</span><span>")       </span><span style=color:#65737e>// 404
</span><span>Error::conflict("</span><span style=color:#a3be8c>already exists</span><span>")        </span><span style=color:#65737e>// 409
</span><span>Error::validation("</span><span style=color:#a3be8c>invalid email</span><span>")       </span><span style=color:#65737e>// 422
</span><span>Error::rate_limited("</span><span style=color:#a3be8c>too many requests</span><span>") </span><span style=color:#65737e>// 429
</span><span>Error::internal("</span><span style=color:#a3be8c>something went wrong</span><span>")  </span><span style=color:#65737e>// 500
</span></code></pre><h2 id=using-errors-in-handlers>Using Errors in Handlers</h2><p>Return <code>Result&LTT, Error></code> or just <code>Result&LTT></code> from handlers:<pre class=language-rust data-lang=rust style=color:#c0c5ce;background-color:#2b303b><code class=language-rust data-lang=rust><span>#[</span><span style=color:#bf616a>get</span><span>("</span><span style=color:#a3be8c>/users/:id</span><span>")]
</span><span>async </span><span style=color:#b48ead>fn </span><span style=color:#8fa1b3>get_user</span><span>(</span><span style=color:#bf616a>id</span><span>: Path<</span><span style=color:#b48ead>u64</span><span>>) -> Result&LTJson&LTUser>> {
</span><span>    </span><span style=color:#b48ead>let</span><span> id = id.</span><span style=color:#96b5b4>into_inner</span><span>();
</span><span>
</span><span>    </span><span style=color:#b48ead>if</span><span> id == </span><span style=color:#d08770>0 </span><span>{
</span><span>        </span><span style=color:#b48ead>return </span><span>Err(Error::bad_request("</span><span style=color:#a3be8c>id cannot be zero</span><span>"));
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#b48ead>let</span><span> user = </span><span style=color:#96b5b4>find_user</span><span>(id)
</span><span>        .</span><span style=color:#96b5b4>ok_or_else</span><span>(|| Error::not_found("</span><span style=color:#a3be8c>user not found</span><span>"))?;
</span><span>
</span><span>    Ok(Json(user))
</span><span>}
</span></code></pre><h2 id=adding-details>Adding Details</h2><p>Add structured details to errors:<pre class=language-rust data-lang=rust style=color:#c0c5ce;background-color:#2b303b><code class=language-rust data-lang=rust><span>Error::validation("</span><span style=color:#a3be8c>invalid input</span><span>")
</span><span>    .</span><span style=color:#96b5b4>with_details</span><span>(serde_json::json!({
</span><span>        "</span><span style=color:#a3be8c>field</span><span>": "</span><span style=color:#a3be8c>email</span><span>",
</span><span>        "</span><span style=color:#a3be8c>reason</span><span>": "</span><span style=color:#a3be8c>invalid format</span><span>"
</span><span>    }))
</span></code></pre><p>Response:<pre class=language-json data-lang=json style=color:#c0c5ce;background-color:#2b303b><code class=language-json data-lang=json><span>{
</span><span>  "</span><span style=color:#a3be8c>error</span><span>": {
</span><span>    "</span><span style=color:#a3be8c>code</span><span>": "</span><span style=color:#a3be8c>VALIDATION_ERROR</span><span>",
</span><span>    "</span><span style=color:#a3be8c>message</span><span>": "</span><span style=color:#a3be8c>invalid input</span><span>",
</span><span>    "</span><span style=color:#a3be8c>details</span><span>": {
</span><span>      "</span><span style=color:#a3be8c>field</span><span>": "</span><span style=color:#a3be8c>email</span><span>",
</span><span>      "</span><span style=color:#a3be8c>reason</span><span>": "</span><span style=color:#a3be8c>invalid format</span><span>"
</span><span>    }
</span><span>  },
</span><span>  "</span><span style=color:#a3be8c>trace_id</span><span>": "</span><span style=color:#a3be8c>...</span><span>"
</span><span>}
</span></code></pre><h2 id=domain-errors>Domain Errors</h2><p>Define typed domain errors with automatic API conversion:<pre class=language-rust data-lang=rust style=color:#c0c5ce;background-color:#2b303b><code class=language-rust data-lang=rust><span style=color:#b48ead>enum </span><span>UserError {
</span><span>    NotFound(</span><span style=color:#b48ead>u64</span><span>),
</span><span>    EmailTaken(String),
</span><span>}
</span><span>
</span><span style=color:#b48ead>impl </span><span>IntoApiError </span><span style=color:#b48ead>for </span><span>UserError {
</span><span>    </span><span style=color:#b48ead>fn </span><span style=color:#8fa1b3>into_api_error</span><span>(</span><span style=color:#bf616a>self</span><span>) -> Error {
</span><span>        </span><span style=color:#b48ead>match </span><span style=color:#bf616a>self </span><span>{
</span><span>            UserError::NotFound(id) => Error::not_found(format!("</span><span style=color:#a3be8c>user </span><span style=color:#d08770>{}</span><span style=color:#a3be8c> not found</span><span>", id)),
</span><span>            UserError::EmailTaken(email) => Error::conflict(format!("</span><span style=color:#a3be8c>email </span><span style=color:#d08770>{}</span><span style=color:#a3be8c> taken</span><span>", email)),
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre><p>Use with the <code>?</code> operator:<pre class=language-rust data-lang=rust style=color:#c0c5ce;background-color:#2b303b><code class=language-rust data-lang=rust><span>#[</span><span style=color:#bf616a>get</span><span>("</span><span style=color:#a3be8c>/users/:id</span><span>")]
</span><span>async </span><span style=color:#b48ead>fn </span><span style=color:#8fa1b3>get_user</span><span>(</span><span style=color:#bf616a>id</span><span>: Path<</span><span style=color:#b48ead>u64</span><span>>) -> Result&LTJson&LTUser>, UserError> {
</span><span>    </span><span style=color:#b48ead>let</span><span> id = id.</span><span style=color:#96b5b4>into_inner</span><span>();
</span><span>    </span><span style=color:#b48ead>let</span><span> user = </span><span style=color:#96b5b4>find_user</span><span>(id).</span><span style=color:#96b5b4>ok_or</span><span>(UserError::NotFound(id))?;
</span><span>    Ok(Json(user))
</span><span>}
</span></code></pre><h2 id=documented-errors>Documented Errors</h2><p>Document error responses for OpenAPI generation:<pre class=language-rust data-lang=rust style=color:#c0c5ce;background-color:#2b303b><code class=language-rust data-lang=rust><span style=color:#b48ead>use </span><span>rapina::prelude::*;
</span><span>
</span><span style=color:#b48ead>struct </span><span>GetUserHandler;
</span><span>
</span><span style=color:#b48ead>impl </span><span>DocumentedError </span><span style=color:#b48ead>for </span><span>GetUserHandler {
</span><span>    </span><span style=color:#b48ead>fn </span><span style=color:#8fa1b3>error_responses</span><span>() -> Vec&LTErrorVariant> {
</span><span>        vec![
</span><span>            ErrorVariant::new(</span><span style=color:#d08770>400</span><span>, "</span><span style=color:#a3be8c>BAD_REQUEST</span><span>", "</span><span style=color:#a3be8c>Invalid user ID</span><span>"),
</span><span>            ErrorVariant::new(</span><span style=color:#d08770>404</span><span>, "</span><span style=color:#a3be8c>NOT_FOUND</span><span>", "</span><span style=color:#a3be8c>User not found</span><span>"),
</span><span>        ]
</span><span>    }
</span><span>}
</span></code></pre><h2 id=error-codes>Error Codes</h2><table><thead><tr><th>HTTP Status<th>Code<th>Use Case<tbody><tr><td>400<td><code>BAD_REQUEST</code><td>Invalid input, malformed request<tr><td>401<td><code>UNAUTHORIZED</code><td>Missing or invalid authentication<tr><td>403<td><code>FORBIDDEN</code><td>Authenticated but not allowed<tr><td>404<td><code>NOT_FOUND</code><td>Resource doesn't exist<tr><td>409<td><code>CONFLICT</code><td>Resource already exists<tr><td>422<td><code>VALIDATION_ERROR</code><td>Input validation failed<tr><td>429<td><code>RATE_LIMITED</code><td>Too many requests<tr><td>500<td><code>INTERNAL_ERROR</code><td>Server error</table><div class=page-meta></div></article></div></main><footer class=footer><div class=footer-container><p>Built with Rust. Documented with <a href=https://www.getzola.org/ target=_blank>Zola</a>.<p>MIT License</div></footer>